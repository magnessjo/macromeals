var viewSpecificOptions={week:{titleFormat:"MMMM D, YYYY",columnFormat:"ddd D",timeFormat:"LT",slotLabelFormat:"LT"},day:{titleFormat:"dddd, MMMM D, YYYY",columnFormat:"",timeFormat:"LT",slotLabelFormat:"LT"}},selectedCalendarsStorageKey="calendar-selectedCalendars",qTipsEnabled=!0,$calendar=$("#solspace-calendar"),$miniCal=$("#calendar-mini-cal"),isLocalized=Craft.isLocalized;$(function(){"use strict";var e=new moment;"undefined"!=typeof calendarCurrentDay&&(e=new moment(calendarCurrentDay));var a={refresh:{text:Craft.t("Refresh"),click:function(){$calendar.fullCalendar("refetchEvents")}}};isLocalized&&(a.localeButton={text:localeMap[currentLocaleId],click:function(e){var a=$(".fc-localeButton-button",$calendar);if(void 0===a.data("initialized")){var t=$("<div>",{class:"menu"}).insertAfter(e.currentTarget),n=$("<ul>").appendTo(t);for(var l in localeMap)localeMap.hasOwnProperty(l)&&$("<li>").append($("<a>",{"data-locale-id":l,text:localeMap[l]})).appendTo(n);new Garnish.MenuBtn(e.currentTarget,{onOptionSelect:function(e){currentLocaleId=$(e).data("locale-id"),a.text(localeMap[currentLocaleId]),$calendar.fullCalendar("refetchEvents")}}).showMenu(),a.data("initialized",!0)}}}),$calendar.fullCalendar({defaultDate:e,defaultView:$calendar.data("view"),nextDayThreshold:"0"+calendarOverlapThreshold+":00:01",fixedWeekCount:!0,eventLimit:5,aspectRatio:1.3,editable:canEditEvents,lang:calendarLocale,views:viewSpecificOptions,firstDay:calendarFirstDayOfWeek,viewRender:renderView,events:getEvents,eventRender:renderEvent,dayRender:renderDay,eventDragStart:closeAllQTips,eventDragStop:enableQTips,eventDrop:eventDateChange,eventResizeStart:closeAllQTips,eventResizeStop:enableQTips,eventResize:eventDurationChange,selectable:canQuickCreate&&canEditEvents,selectHelper:canQuickCreate&&canEditEvents,select:showEventCreator,unselectAuto:!1,customButtons:a,header:{right:"localeButton refresh prev,today,next",left:"title"}}),"month"!==$calendar.fullCalendar("getView").name&&$calendar.fullCalendar("option","height","auto"),$(".fc-next-button, .fc-prev-button, .fc-today-button",$calendar).on({click:function(){var e=$calendar.fullCalendar("getView").type,a=$calendar.fullCalendar("getDate"),t=a.format("YYYY"),n=a.format("MM"),l=a.format("DD"),r="month";switch(e){case"agendaDay":r="day";break;case"agendaWeek":r="week"}var d=Craft.getCpUrl("calendar/view/"+r+"/"+t+"/"+n+"/"+l);history.pushState("data","",d)}}),$(".alert-dismissible a.close").on({click:function(){var e=$(this).parents(".alert:first");Craft.postActionRequest("calendar/view/dismissDemoAlert",{},function(a){e.remove()})}}),$(".calendar-list input").on({change:function(){var e={};$("ul.calendar-list input").map(function(){e[$(this).val()]=$(this).is(":checked")}).get().join(),localStorage.setItem(selectedCalendarsStorageKey,JSON.stringify(e));var a=[];for(var t in e)e.hasOwnProperty(t)&&e[t]&&a.push(t);$miniCal.data("calendars",a.join(",")),$miniCal.fullCalendar("refetchEvents"),$calendar.fullCalendar("refetchEvents")}});var t=$("#event-creator"),n=$(".lightswitch",t);n.on({change:function(){var e=$(".timewrapper",t);$("input",this).val()?e.fadeOut("fast"):e.fadeIn("fast")}})});var selectedCalendars=localStorage.getItem(selectedCalendarsStorageKey);if(null!=selectedCalendars){var usedCalendarIds=[],allCalendarIds=$("ul.calendar-list input").map(function(){return parseInt($(this).val())}).get(),calendarMap={};"{"===selectedCalendars.substring(0,1)&&(calendarMap=JSON.parse(selectedCalendars));for(var index=0;index<allCalendarIds.length;index++){var calendarId=allCalendarIds[index];void 0==calendarMap[calendarId]?(calendarMap[calendarId]=!0,usedCalendarIds.push(calendarId)):1==calendarMap[calendarId]&&usedCalendarIds.push(calendarId)}$miniCal.data("calendars",usedCalendarIds.join(",")),$miniCal.fullCalendar("refetchEvents"),$(".calendar-list input").each(function(){var e=$(this).val(),a=void 0==calendarMap[e]||1==calendarMap[e];$(this).prop("checked",a)})}