function showEventCreator(e,t){eventCreatorShown||(eventCreatorShown=!0,$("<div />").qtip({content:{text:$("#event-creator"),title:Craft.t("New Event")},position:{my:"center",at:"center",target:$(window)},show:{ready:!0,modal:{on:!0,blur:!1}},hide:!1,style:{classes:"qtip-bootstrap dialogue",width:500},events:{render:function(a,r){var n=r.elements.content;$("ul.errors",n).empty();var l=e.utc().format("HHmmss"),i=t.utc().format("HHmmss"),s=!1;l===i&&"000000"==i&&(t.subtract(1,"seconds"),s=!0);var o=createDateAsUTC(e.toDate()),d=createDateAsUTC(t.toDate()),c=$("#event-creator");c.addClass("shown");var u=$("#startDate-date",c),p=$("#startDate-time",c),m=$("#endDate-date",c),v=$("#endDate-time",c);u.datepicker("setDate",o),m.datepicker("setDate",d),p.timepicker("setTime",o),v.timepicker("setTime",d);var f=$("input[name=allDay]"),h=f.parents(".lightswitch:first");$("input",h).val(s?1:""),s?(h.data("lightswitch").turnOn(),$(".timewrapper",c).hide()):(h.data("lightswitch").turnOff(),$(".timewrapper",c).show()),setTimeout(function(){$("input[name=title]:first",n).val("").focus().bind("keypress",function(e){var t=e.which?e.which:e.keyCode;13==t&&$("button.submit",n).trigger("click")})},100);var C=p.timepicker("option","timeFormat"),w=C.replace("h","hh").replace("H","HH").replace("G","H").replace("g","h").replace("A","a").replace("i","mm");$("button.submit",n).unbind("click").click(function(e){var t=$("input[name=title]",n).val(),a=$("select[name=calendarId]",n).val(),l=moment(u.datepicker("getDate")),i=moment(p.val().replace(/(a|p)\.(m)\./gi,"$1$2"),w),s=moment(m.datepicker("getDate")),o=moment(v.val().replace(/(a|p)\.(m)\./gi,"$1$2"),w),d={startDate:l.format("YYYY-MM-DD")+" "+i.format("HH:mm:ss"),endDate:s.format("YYYY-MM-DD")+" "+o.format("HH:mm:ss"),allDay:f.val(),event:{title:t,calendarId:a}};d[csrfTokenName]=csrfTokenValue,$.ajax({url:Craft.getCpUrl("calendar/events/api/create"),type:"post",dataType:"json",data:d,success:function(t){t.error?$("ul.errors",n).empty().append($("<li />",{text:t.error})):t.event&&($calendar.fullCalendar("renderEvent",t.event),$calendar.fullCalendar("unselect"),r.hide(e))},error:function(e){alert(e)}})}),$("button.delete",n).unbind("click").click(function(){r.hide()})},hide:function(e,t){$("#event-creator").removeClass("shown").insertAfter($calendar),$calendar.fullCalendar("unselect"),eventCreatorShown=!1,t.destroy()}}}))}function buildEventPopup(e,t){if(e.calendar){var a=$("<div>"),r=$("<div>",{"class":"calendar-data",html:'<span class="color-indicator" style="background-color: '+e.backgroundColor+';"></span> '+e.calendar.name}),n=moment(e.start),l=moment(e.end),i="dddd, MMMM D, YYYY";if(e.allDay)l.subtract(1,"days");else{var s="H:i"==calendarTimeFormat?"HH:mm":"h:mma";i=i+" \\a\\t "+s}var o=$("<div>",{"class":"event-date-range separator",html:'<div style="white-space: nowrap;"><label>'+Craft.t("Starts")+":</label>"+n.format(i)+'</div><div style="white-space: nowrap;"><label>'+Craft.t("Ends")+":</label>"+l.format(i)+"</div>"}),d="";if(e.repeats&&(d=$("<div>",{"class":"event-repeats separator",html:"<label>"+Craft.t("Repeats")+":</label>"+e.readableRepeatRule})),e.editable){var c=$("<div>",{"class":"buttons"});c.append($("<a>",{"class":"btn small submit",href:Craft.getCpUrl("calendar/events/"+e.id+(Craft.isLocalized?"/"+currentLocaleId:"")),text:Craft.t("Edit")})),c.append($("<a>",{"class":"btn small delete-event",href:Craft.getCpUrl("calendar/events/api/delete"),text:Craft.t("Delete"),data:{id:e.id}})),e.repeats&&c.append($("<a>",{"class":"btn small delete-event-occurrence",href:Craft.getCpUrl("calendar/events/api/deleteOccurrence"),text:Craft.t("Delete occurrence"),data:{id:e.id,date:e.start.toISOString()}}))}t.qtip({content:{title:e.title,button:!0,text:a.add(r).add(o).add(d).add(c)},style:{classes:"qtip-bootstrap qtip-event",tip:{width:30,height:15}},position:{my:"right center",at:"left center",viewport:$(window),adjust:{method:"shift flip"}},show:{solo:!0,delay:500},hide:{fixed:!0,delay:300},events:{show:function(e){qTipsEnabled||e.preventDefault()},render:function(t,a){$("a.delete-event-occurrence",a.elements.content).click(function(){var t=$(this).attr("href"),r=$(this).data("id"),n=$(this).data("date");if(confirm(Craft.t("Are you sure?"))){var l={eventId:r,date:n};l[csrfTokenName]=csrfTokenValue,$.ajax({url:t,type:"post",dataType:"json",data:l,success:function(t){return t.error?void alert(t.error):($calendar.fullCalendar("removeEvents",function(t){return t.id==e.id&&t.start.isSame(e.start)}),void a.destroy())}})}return!1}),$("a.delete-event",a.elements.content).click(function(){var t=$(this).attr("href"),r=$(this).data("id");if(confirm(Craft.t("Are you sure you want to delete this event?"))){var n={eventId:r};n[csrfTokenName]=csrfTokenValue,$.ajax({url:t,type:"post",dataType:"json",data:n,success:function(t){return t.error?void alert(t.error):($calendar.fullCalendar("removeEvents",e.id),void a.destroy())}})}return!1})}}})}}function createDateAsUTC(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())}var eventCreatorShown=!1;