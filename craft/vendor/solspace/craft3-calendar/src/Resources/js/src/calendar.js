"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},viewSpecificOptions={week:{titleFormat:"MMMM D, YYYY",columnFormat:"ddd D",timeFormat:"LT",slotLabelFormat:"LT"},day:{titleFormat:"dddd, MMMM D, YYYY",columnFormat:"",timeFormat:"LT",slotLabelFormat:"LT"}},selectedCalendarsStorageKey="calendar-selectedCalendars",qTipsEnabled=!0,$calendar=$("#solspace-calendar"),$miniCal=$("#calendar-mini-cal");$(function(){var e=$calendar.data(),a=e.currentDay,t=e.siteMap,n=e.overlapThreshold,r=e.language,l=e.firstDayOfWeek,d=$calendar.data(),i=d.currentSiteId,c=d.canEditEvents,o=d.canQuickCreate,s=d.isMultiSite;c=void 0!==c,o=void 0!==o,s=void 0!==s;var u=new moment;void 0!==("undefined"==typeof a?"undefined":_typeof(a))&&(u=new moment(a));var f={refresh:{text:Craft.t("calendar","Refresh"),click:function(){$calendar.fullCalendar("refetchEvents")}},Today:{text:Craft.t("calendar","Today"),click:function(){$calendar.fullCalendar("today")}}};s&&(f.siteButton={text:t[i],click:function(e){var a=$(".fc-siteButton-button",$calendar);if(void 0===a.data("initialized")){var n=$("<div>",{"class":"menu"}).insertAfter(e.currentTarget),r=$("<ul>").appendTo(n);for(var l in t)t.hasOwnProperty(l)&&$("<li>").append($("<a>",{"data-site-id":l,text:t[l]})).appendTo(r);new Garnish.MenuBtn(e.currentTarget,{onOptionSelect:function(e){var n=$(e).data("site-id");$calendar.data("current-site-id",n),a.text(t[n]),$calendar.fullCalendar("refetchEvents")}}).showMenu(),a.data("initialized",!0)}}}),$calendar.fullCalendar({defaultDate:u,defaultView:$calendar.data("view"),nextDayThreshold:"0"+n+":00:01",fixedWeekCount:!0,eventLimit:5,aspectRatio:1.3,editable:c,lang:r,views:viewSpecificOptions,firstDay:l,viewRender:renderView,events:getEvents,eventRender:renderEvent,dayRender:renderDay,eventDragStart:closeAllQTips,eventDragStop:enableQTips,eventDrop:eventDateChange,eventResizeStart:closeAllQTips,eventResizeStop:enableQTips,eventResize:eventDurationChange,selectable:o&&c,selectHelper:o&&c,select:showEventCreator,unselectAuto:!1,customButtons:f,header:{right:"siteButton refresh prev,Today,next",left:"title"}}),"month"!==$calendar.fullCalendar("getView").name&&$calendar.fullCalendar("option","height","auto"),$(".fc-next-button, .fc-prev-button, .fc-today-button",$calendar).on({click:function(){var e=$calendar.fullCalendar("getView").type,a=$calendar.fullCalendar("getDate"),t=a.format("YYYY"),n=a.format("MM"),r=a.format("DD"),l="month";switch(e){case"agendaDay":l="day";break;case"agendaWeek":l="week"}var d=Craft.getCpUrl("calendar/view/"+l+"/"+t+"/"+n+"/"+r);history.pushState("data","",d)}}),$(".alert-dismissible a.close").on({click:function(){var e=$(this).parents(".alert:first");Craft.postActionRequest("calendar/view/dismiss-demo-alert",{},function(a){e.remove()})}}),$(".calendar-list input").on({change:function(){var e={};$("ul.calendar-list input").map(function(){e[$(this).val()]=$(this).is(":checked")}).get().join(),localStorage.setItem(selectedCalendarsStorageKey,JSON.stringify(e));var a=[];for(var t in e)e.hasOwnProperty(t)&&e[t]&&a.push(t);$miniCal.data("calendars",a.join(",")),$miniCal.fullCalendar("refetchEvents"),$calendar.fullCalendar("refetchEvents")}});var p=$("#event-creator"),v=$(".lightswitch",p);v.on({change:function(){var e=$(".timewrapper",p);$("input",this).val()?e.fadeOut("fast"):e.fadeIn("fast")}})});var selectedCalendars=localStorage.getItem(selectedCalendarsStorageKey);if(null!==selectedCalendars){var usedCalendarIds=[],allCalendarIds=$("ul.calendar-list input").map(function(){return parseInt($(this).val())}).get(),calendarMap={};"{"===selectedCalendars.substring(0,1)&&(calendarMap=JSON.parse(selectedCalendars));for(var index=0;index<allCalendarIds.length;index++){var calendarId=allCalendarIds[index];void 0===calendarMap[calendarId]?(calendarMap[calendarId]=!0,usedCalendarIds.push(calendarId)):calendarMap[calendarId]===!0&&usedCalendarIds.push(calendarId)}$miniCal.data("calendars",usedCalendarIds.join(",")),$miniCal.fullCalendar("refetchEvents"),$(".calendar-list input").each(function(){var e=$(this).val(),a=void 0===calendarMap[e]||calendarMap[e]===!0;$(this).prop("checked",a)})}