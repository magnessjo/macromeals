"use strict";function convertDateFormatToMomentFormat(e){return e=e.replace(/m/g,"M").replace(/d/g,"D").replace(/yy/g,"YYYY")}function getDayAbbreviationFromDay(e){switch(e=parseInt(e)){case 0:return"SU";case 1:return"MO";case 2:return"TU";case 3:return"WE";case 4:return"TH";case 5:return"FR";case 6:return"SA"}throw"Wrong day given: "+e+". Expected 0-6"}function eventEditorInit(e){var t=e,a=$("input[name='calendarEvent[startDate][date]']",t),n=$("input[name='calendarEvent[startDate][time]']",t),r=$("#untilChoice",t),c=$("#calendarEventcount",t),i=$(".event-until-date",t),o=$(".event-exception-date",t),s=$(".event-select-date",t),p=$("input[name='calendarEvent[endDate][date]']",t),d=$("input[name='calendarEvent[endDate][time]']",t),l=$("#tabs a.tab");n.timepicker("option","step",calendarTimeInterval),d.timepicker("option","step",calendarTimeInterval),a.datepicker("option","onSelect",function(e){p.datepicker("option","minDate",e),p.val(e),s.datepicker("option","minDate",e),s.datepicker("option","defaultDate",e),i.datepicker("option","defaultDate",e);var n=a.datepicker("getDate");if(n){n=new moment(n);var r=getDayAbbreviationFromDay(n.format("d")),c=n.format("D"),o=n.format("M"),d=n.toDate().getNthOfMonth();d>4&&(d=-1);var l=$(".recurrence-block.recurs-weekly .days",t);$("input:checkbox:checked",l).length<=1&&($("input:checkbox:checked",l).prop("checked",!1),$("input:checkbox[value="+r+"]",l).prop("checked",!0));var h=$(".recurrence-block.recurs-monthly .days",t);$("input:checkbox:checked",h).length<=1&&($("input:checkbox:checked",h).prop("checked",!1),$("input:checkbox[value="+r+"]",h).prop("checked",!0));var u=$(".recurrence-block.recurs-monthly .month-days",t);$("input:checkbox:checked",u).length<=1&&($("input:checkbox:checked",u).prop("checked",!1),$("input:checkbox[value="+c+"]",u).prop("checked",!0)),$('select[name="calendarEvent[monthly][repeatsByDayInterval]"]').val(d),$('select[name="calendarEvent[yearly][repeatsByDayInterval]"]').val(d);var m=$(".recurrence-block.recurs-yearly .months",t);$("input:checkbox:checked",m).length<=1&&($("input:checkbox:checked",m).prop("checked",!1),$("input:checkbox[value="+o+"]",m).prop("checked",!0));var v=$(".recurrence-block.recurs-yearly .days",t);$("input:checkbox:checked",v).length<=1&&($("input:checkbox:checked",v).prop("checked",!1),$("input:checkbox[value="+r+"]",v).prop("checked",!0))}}),n.on("change",function(){var e=a.datepicker("getDate"),r=p.datepicker("getDate"),c=0;e&&r&&(c=Math.round((r-e)/864e5));var i=n.timepicker("getTime"),o=n.timepicker("getTime");if(i){if(o.setMinutes(i.getMinutes()+parseInt(calendarEventDuration)),d.timepicker("option","durationTime",i),0===c){var s=n.timepicker("getTime");s.setMinutes(i.getMinutes()+parseInt(calendarTimeInterval)),d.timepicker("option","showDuration",!0),d.timepicker("option","minTime",s),$(this).val()&&d.timepicker("setTime",o)}else d.timepicker("option","showDuration",!1),d.timepicker("option","minTime","00:00"),$(this).val()&&d.timepicker("setTime",i);$(".calendarCalendarSelect",t).trigger("change")}}),d.on("change",function(){var e=a.datepicker("getDate"),r=p.datepicker("getDate"),c=0;if(e&&r&&(c=Math.round((r-e)/864e5)),!c){var i=n.timepicker("getTime"),o=d.timepicker("getTime");if(o<i){var s=a.datepicker("getDate");s.setDate(s.getDate()+1),p.datepicker("setDate",s),d.timepicker("option","showDuration",!1),d.timepicker("option","minTime","00:00")}}$(".calendarCalendarSelect",t).trigger("change")}),p.on("change",function(){n.trigger("change")});var h=$(".event-all-day .lightswitch",t);h.on({change:function(){var e=$('[data-affected-by="all-day-toggle"] .timewrapper',t),a=$(".cal-date-row",t);$("input",this).val()?(e.hide(),a.addClass("short")):(setTimeout(function(){e.fadeIn("fast")},300),a.removeClass("short"))}});var u=$(".recurrence-switch .lightswitch",t);u.on({change:function(){var e=$(".recurrence-choices",t),a=$(".recurrence-wrapper",t);$("input",this).val()?(e.removeClass("no-show"),a.show()):(e.addClass("no-show"),a.hide())}});var m=$('input[type=checkbox][name$="[yearly][repeatsBy]"]',t);m.on({change:function(){var e=$(".recurs-yearly",t);$(this).is(":checked")?e.slideDown("fast"):e.slideUp("fast")}});var v=$(".event-frequency select",t);v.on({change:function(){var e=$(this).val(),a=$(".recurs-weekly",t),n=$(".recurs-monthly",t),r=$(".recurs-yearly",t),c=$(".recurrence-choice-monthly",t),i=$(".recurrence-choice-yearly",t),o=$(".until-switch",t),s=$(".exception-dates-wrapper",t),p=$(".select-dates-wrapper",t),d=$(".event-interval",t);switch(a.slideUp("fast"),n.slideUp("fast"),r.slideUp("fast"),c.slideUp("fast"),i.slideUp("fast"),o.hide(),s.hide(),p.hide(),d.hide(),e){case"WEEKLY":a.slideDown("fast");break;case"MONTHLY":n.slideDown("fast"),c.slideDown("fast");break;case"YEARLY":i.slideDown("fast"),m.trigger("change")}switch(e){case"DAILY":case"WEEKLY":case"MONTHLY":case"YEARLY":o.show(),s.show(),d.show();break;case"SELECT_DATES":p.show()}}});var k=$('input[type=radio][name$="[monthly][repeatsBy]"]',t);k.on({change:function(){if($(this).is(":checked")){var e=$(".recurs-monthly div.days",t),a=$(".recurs-monthly div.month-days",t);e.slideUp("fast"),a.slideUp("fast"),"byMonthDay"===$(this).val()?a.slideDown("fast"):e.slideDown("fast")}}});var g=$("ul.date-list",t);g.on({click:function(){var e=$(this),t=e.parents("li:first");t.parents("ul:first");t.remove()}},"> li > a"),r.on({change:function(){var e=$(this).val();switch(i.parents("li:first").hide(),c.parents("li:first").hide(),e){case"until":i.parents("li:first").fadeIn("fast");break;case"count":c.parents("li:first").fadeIn("fast")}}}),o.datepicker("option","onSelect",function(e){var a=new moment(e,convertDateFormatToMomentFormat(Craft.datepickerOptions.dateFormat)),n=$("<li />"),r=$("<input />");r.attr("type","hidden").attr("name","calendarEvent[exceptions][]").val(a.format("YYYY-MM-DD")),n.append("<a></a>").append("<span>"+a.format("ll")+"</span>").append(r),$(".exception-list",t).append(n),o.val("")}),s.datepicker("option","onSelect",function(e){var a=new moment(e,convertDateFormatToMomentFormat(Craft.datepickerOptions.dateFormat)),n=$("<li />"),r=$("<input />");r.attr("type","hidden").attr("name","calendarEvent[selectDates][]").val(a.format("YYYY-MM-DD")),n.append("<a></a>").append("<span>"+a.format("ll")+"</span>").append(r),$(".select-date-list",t).append(n),s.val("")}),s.datepicker("option","minDate",a.datepicker("getDate")),h.trigger("change"),m.trigger("change"),u.trigger("change"),v.trigger("change"),k.trigger("change"),r.trigger("change"),l.on({click:function(){var e=$(this);return e.parent().siblings().find(".tab.sel").removeClass("sel"),e.addClass("sel"),$(".tab-content").addClass("hidden"),$(".tab-content[data-for-tab="+e.data("tab-id")+"]").removeClass("hidden"),!1}})}$(function(){var e=new MutationObserver(function(e){e.forEach(function(e){e.addedNodes&&e.addedNodes.length>0&&e.addedNodes.forEach(function(e){var t=$(e);t.hasClass("lp-editor-container")&&eventEditorInit(t)})})}),t={attributes:!0,childList:!0,characterData:!0};e.observe(document.body,t),$(".calendar-event-wrapper").each(function(){eventEditorInit($(this))})}),Date.prototype.getWeekOfMonth=function(e){var t=this.getMonth(),a=this.getFullYear(),n=new Date(a,t,1).getDay(),r=new Date(a,t+1,0).getDate(),c=this.getDate()+n-1,i=1,o=i+Math.ceil((r+n-7)/7),s=i+Math.floor(c/7);return e||s<2+i?s:s===o?i+5:s},Date.prototype.getNthOfMonth=function(){return Math.ceil(this.getDate()/7)};