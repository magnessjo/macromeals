
{% extends "_layout" %}
{% includeCssFile "/checkout.css" %}
{% includeJsFile "/summary.js" %}

{% set cart = craft.commerce.getCart %}

{% block main %}

  {% if cart.email == '' %}
    {% redirect "/account/checkout-login" 301 %}
  {% endif %}

  <script type="text/javascript">
    window.csrfTokenName = "{{ craft.config.csrfTokenName|e('js') }}";
    window.csrfTokenValue = "{{ craft.request.csrfToken|e('js') }}";
  </script>

  {% include "components/breadcrumb.twig" %}

  <form id="product-list">

    {# Order Summary #}

    <section id="order-summary">

      {% if cart.lineItems | length == 0 %}

        <div class="no-items">

          <div class="lock">

            <p class="acumin-medium">You currently do not have meals in your cart.</p>
            <p class="acumin-small">You can view all of our meals <a href="/shop">here</a>.</p>
            <p>Please contact us at <a href="mailto:help@macromeals.life">help@macromeals.life</a> if you are having any issues adding meals or if you would like to setup a phone call to help walk you through the website.</p>

          </div>

        </div>

      {% else %}

        <div class="item-list">

          <div class="lock">

            <h1 class="acumin-medium-bold">Order Summary</h1>

            <div class="items">

              {% for item in cart.lineItems %}

                {% set variant = item.purchasable %}
                {% set product = variant.product %}
                {% set quantityMoreThanStock = item.qty > variant.stock  %}

                <div class="order-item" data-id="{{ item.id }}">

                  {% if product.productImage|length > 0 %}
                    {% set image = product.productImage[0].url %}
                  {% else %}
                    {% set image = '/images/products/placeholder.jpg' %}
                  {% endif %}

                  <div class="image" style="background-image: url({{ image }})"></div>

                  <div class="wrapper">
                    <h2>{{ product.title }} <span>{{ variant.title }}</span></h2>

                    <div class="item-actions">
                      <div class="increment">
                        <button class="icons minus"></button>
                        <span>{{ item.qty }}</span>
                        <button class="icons plus"></button>
                      </div>
                      <p class="cost">{{ item.subtotal | currency(cart.currency) }}</p>
                      <button class="icons remove"></button>
                    </div>
                  </div>

                </div>

              {% endfor %}

            </div>

          </div>

        </div>

      {% endif %}

    </section>

    {% if cart.lineItems | length != 0 %}

      <section id="cart-total">

        <div class="lock">

          <div class="promo">

            <label>Promotional Code</label>
            <div>
              <input type="text" name="couponCode" value="{{ cart.couponCode }}" placeholder="Code" />
              <button class="call-to-action">{% if cart.couponCode %}Change{% else %}Apply{% endif %}</button>
            </div>

            <p class="text">If you have a promotional code, please add it for your order.</p>

          </div>

          <div class='totals'>

            <p class="acumin-tiny">
              <span class="title">Shipping</span>
              <span class="cost" data-type="shipping-amount">{{ cart.totalShippingCost | currency(cart.currency) }}</span>
            </p>

            <p class="acumin-tiny discount" {% if cart.baseDiscount %} style="display:block;" {% endif %}>
              <span class="title">Discount</span>
              <span class="cost" data-type="discount-amount">{{ cart.baseDiscount | currency(cart.currency) }}</span>
            </p>

            <p class="acumin-tiny">
              <span class="title">SubTotal</span>
              <span class="cost" data-type="items-amount">{{ cart.itemSubtotal | currency(cart.currency) }}</span>
            </p>

            <p class="acumin-tiny">
              <span class="title">Tax</span>
              <span class="cost" data-type="tax-amount">{{ cart.totalTax | commerceCurrency(cart.currency) }}</span>
            </p>

            <p class="acumin-medium-bold">
              <span class="title">Total</span>
              <span class="cost" data-type="total-amount">{{ cart.totalPrice | commerceCurrency(cart.currency, stripZeros = true) }}</span>
            </p>

          </div>

        </div>

      </section>

    {% endif %}

    {# Checkout Actions #}

    {% if cart.lineItems | length != 0 %}

      <section class="checkout-actions">

        <div class="lock">

          <a href="" class="icons">Back <span>to Your Billing</span></a>
          <a href="/checkout/billing" class="call-to-action" data-button="continue">Continue to Billing</a>

        </div>

      </section>

    {% endif %}

  </form>

{% endblock %}
