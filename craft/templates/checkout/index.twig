
{% extends "_layout" %}
{% includeCssFile "/checkout.css" %}
{% includeJsFile "/customer.js" %}

{% set cart = craft.commerce.getCart %}
{% set shippingModel = cart.shippingAddress %}
{% set billingModel = cart.billingAddress %}

{% set addresses = craft.commerce.customer.addresses %}
{% set addressModel = '' %}
{% if addresses %}
  {% set addressModel = addresses[addresses | length - 1] %}
{% endif %}

{% set states = craft.commerce.statesArray["233"] %}

{% block main %}

  {% if cart.email == '' %}
    {% redirect "/account/checkout-login" 301 %}
  {% endif %}

  {% include "components/breadcrumb.twig" %}

  <form method="POST" id="address-info">

    {{ getCsrfInput() }}

    <input type="hidden" name="action" value="commerce/cart/updateCart">
    <input type="hidden" name="redirect" value="checkout/summary">
    <input type='hidden' name="sameAddress" value="1" />
    <input type="hidden" name="shippingAddressId" value="{{ shippingModel is not null ? shippingModel.id : 'new' }}">

    <input type="hidden" name="shippingAddress[countryId]" value='233' />

    <section id="contact-details">

      <div class="lock">

        <p class="required required-disclaimer"><span>Required Field</span></p>

        <p class="acumin-medium-bold">Contact Details</p>

        <div class="field" data-required="true" valid="false">
          <label for="firstName"><span>First Name</span></label>
          <div class="input">
            <input type="text"
                   name="shippingAddress[firstName]"
                   id="firstName"
                   validation="checkForLetter"
                   value="{{ addressModel.firstName ?? '' }}" />

            <div class="errors">
              <p class="required">First name is a required field</p>
              <p class="letters">First name can only contain letters</p>
            </div>
          </div>
        </div>

        <div class="field" data-required="true" valid="false">
          <label for="lastName"><span>Last Name</span></label>
          <div class="input">
            <input type="text"
                   name="shippingAddress[lastName]"
                   id="lastName"
                   validation="checkForLetter"
                   value="{{ addressModel.lastName ?? '' }}" />

            <div class="errors">
              <p class="required">Last name is a required field</p>
              <p class="letters">Last name can only contain letters</p>
            </div>
          </div>
        </div>

      </div>

    </section>

    <section id="shipping-method">

      <div class="lock">

        <h1 class="acumin-medium-bold">Shipping Method</h1>

        <div class="types">

          {% set overnight = 'overnight' %}

          {% for handle, method in craft.commerce.availableShippingMethods  %}

            {% if handle == overnight %}
              <input type="hidden" name="shippingMethod" value="overnight" />
              <div class="shpping-type" data-handle="{{ handle }}" data-active="true">
                <div>
                  <img src="/images/checkout/fedex-logo.png" alt="image of the fedex logo" />
                  <h2 class="acumin-small">{{ method.name }}</h2>
                  <p>FedEx Overnight Ground Delivery.</p>
                  <p>We ship on Monday, Tuesday, Wednesday and Thursday.</p>
                  <p>Delivery cost are determined by your location.</p>
                </div>
              </div>
            {% endif %}

          {% endfor %}

          {% for handle, method in craft.commerce.availableShippingMethods %}

            {% if handle != overnight %}

              <div class="shpping-type" data-handle="{{ handle }}" data-active="false">
                <div>
                  {% if handle == 'pickup' %}<img src="/images/checkout/ymca-logo.png" alt="image of the YMCA logo" />{% endif %}
                  <h2 class="acumin-small">{{ method.name }}</h2>
                  <p>Pickup are scheduled for every Tuesday Morning at 8am at the YMCA in Abingdon Maryland</p>
                  {% if handle == 'pickup' %}
                    <address>
                      101 Walter Ward Blvd,<br>
                      Abingdon, MD 21009
                    </address>
                    <a target="_blank" href="https://www.google.com/maps/place/The+Ward+Y+in+Abingdon/@39.4651901,-76.30869,17z/data=!3m1!4b1!4m5!3m4!1s0x89c7e7aff9cdd5c3:0xd8d4b8d7898c3704!8m2!3d39.4651901!4d-76.3065013">View on Map</a>
                  {% endif %}
                </div>
              </div>

            {% endif %}

          {% endfor %}

        </div>

      </div>

    </section>

    <section id="customer-address">

      <div class="lock">

        <p class="acumin-medium-bold">Shipping Address</p>

        <div class="field" data-required="true" valid="false">
          <label for="address"><span>Shipping Address 1</span></label>
          <div class="input">
            <input type="text"
                   name="shippingAddress[address1]"
                   id="address1"
                   value="{{ addressModel.address1 ?? '' }}" />

            <div class="errors">
              <p class="required">Shipping address is a required field</p>
            </div>
          </div>
        </div>

        <div class="field" valid="true">
          <label for="address-two">Shipping Address 2</label>
          <div class="input">
            <input type="text"
                   name="shippingAddress[address2]"
                   id="address2"
                   value="{{ addressModel.address2 ?? '' }}" />

            <div class="errors"></div>
          </div>
        </div>

        <div class="field" data-required="true" valid="false">
          <label for="city"><span>Shipping City</span></label>
          <div class="input">
            <input type="text"
                   name="shippingAddress[city]"
                   id="city"
                   value="{{ addressModel.city ?? '' }}" />

            <div class="errors">
              <p class="required">Shipping city is a required field</p>
            </div>
          </div>
        </div>

        <div class="field" data-required="true" valid="false">
          <label for="zip"><span>Shipping Zip</span></label>
          <div class="input">
            <input type="text"
                   name="shippingAddress[zipCode]"
                   id="zipCode"
                   value="{{ addressModel.zipCode ?? '' }}" />

            <div class="errors">
              <p class="required">Shipping zip code is a required field</p>
            </div>
          </div>
        </div>

        <div class="field" data-required="true" valid="true">
          <label for="state"><span>Shipping State</span></label>
          <div class="input">
            <select name="shippingAddress[stateId]" >
              <option disabled selected value> Please Choose </option>
              {% for state in craft.commerce.states %}

                {% if addressModel %}

                  {% if addressModel.state == state %}
                    <option value="{{ addressModel.stateId }}" selected> {{ addressModel.state }}</option>
                  {% else %}
                    <option value="{{ state.id }}">{{ state.name }}</option>
                  {% endif %}

                {% else %}
                  <option value="{{ state.id }}">{{ state.name }}</option>
                {% endif %}

              {% endfor %}
            </select>
          </div>

        </div>

      </div>

    </section>

    <section class="action">

      <div class="lock">

        <div class="actions">
          <input type="submit" data-button="continue" value="Continue to Order Summary" class="call-to-action">
        </div>

      </div>

    </section>

  </form>

{% endblock %}
